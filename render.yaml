services:
  # ================================
  # BACKEND (Node.js)
  # ================================
  - type: web
    name: ewaste-backend
    env: node
    plan: starter
    repo: https://github.com/Jashnoor-gill/E-waste
    root: backend
    buildCommand: npm install
    startCommand: node index.js
    envVars:
      - key: MODEL_SERVICE_URL
      - key: ADMIN_TOKEN
      - key: DEVICE_TOKENS

  # ================================
  # MODEL SERVICE (Python)
  # ================================
  - type: web
    name: model-service
    env: python
    plan: standard
    repo: https://github.com/Jashnoor-gill/E-waste
    root: backend/model_service
    buildCommand: >
          buildCommand: |
      .venv/bin/python -m pip install --upgrade pip setuptools wheel && .venv/bin/python -m pip install --no-cache-dir --index-url https://download.pytorch.org/whl/cpu "torch==2.5.1+cpu" "torchvision==0.20.0+cpu" && .venv/bin/python -m pip install --no-cache-dir -r requirements.txt

    startCommand: gunicorn -k uvicorn.workers.UvicornWorker app:app --bind 0.0.0.0:$PORT --workers 1
    envVars:
      - key: MODEL_PATH
      - key: PORT
